(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[799],{9508:function(e,s,o){Promise.resolve().then(o.bind(o,1167))},1167:function(e,s,o){"use strict";o.d(s,{default:function(){return l}});var t=o(7437),i=o(2265),n=o(3949),a=o(3303),r=o(9376);function l(){let{t:e}=(0,n.$G)(["rooms","common"]),[s,o]=(0,i.useState)([]),[l,c]=(0,i.useState)([]),[m,u]=(0,i.useState)(!0),[d,x]=(0,i.useState)(""),[h,g]=(0,i.useState)(""),[v,p]=(0,i.useState)(!1),[b,j]=(0,i.useState)({juego:"",regiones:[],idiomas:[],paises:[],sistemas:[],soloConUsuarios:!1,ordenarPor:"usuarios"}),D=(0,r.useRouter)(),f=async()=>{try{let e,s;console.log("\uD83D\uDD0D Cargando salas con conteo de usuarios...");let{data:t,error:i}=await a.O.from("rooms_with_user_count").select("*").order("active_users_count",{ascending:!1});if(!i&&t)e=t,s=null;else{console.log("⚠️ Vista no disponible, usando fallback...");let{data:o,error:t}=await a.O.from("rooms").select("*").order("created_at",{ascending:!1});if(t)throw t;e=await Promise.all(o.map(async e=>{let{data:s}=await a.O.from("room_users").select("is_active").eq("room_id",e.id),o=(null==s?void 0:s.filter(e=>e.is_active).length)||0,t=(null==s?void 0:s.length)||0;return{...e,active_users_count:o,total_users_count:t,room_status:0===o?"EMPTY":1===o?"SINGLE_USER":"ACTIVE"}})),s=null}if(console.log("\uD83D\uDCCA Resultado:",{data:e,error:s,rooms_found:null==e?void 0:e.length}),s){console.error("❌ Error:",s);let e=s&&"object"==typeof s&&"message"in s?String(s.message):"Error desconocido";x("Error al cargar salas: ".concat(e))}else o(e||[])}catch(e){console.error("❌ Error inesperado:",e),x("Error inesperado al cargar las salas")}u(!1)};(0,i.useEffect)(()=>{let e=[...s];switch(h&&(e=e.filter(e=>e.nombre.toLowerCase().includes(h.toLowerCase())||e.juego.toLowerCase().includes(h.toLowerCase()))),b.juego&&(e=e.filter(e=>e.juego.toLowerCase().includes(b.juego.toLowerCase()))),b.soloConUsuarios&&(e=e.filter(e=>e.active_users_count>0)),b.regiones.length>0&&(e=e.filter(e=>{var s;return null===(s=e.regiones)||void 0===s?void 0:s.some(e=>b.regiones.includes(e))})),b.idiomas.length>0&&(e=e.filter(e=>{var s;return null===(s=e.idiomas)||void 0===s?void 0:s.some(e=>b.idiomas.includes(e))})),b.paises.length>0&&(e=e.filter(e=>{var s;return null===(s=e.paises)||void 0===s?void 0:s.some(e=>b.paises.includes(e))})),b.sistemas.length>0&&(e=e.filter(e=>{var s;return null===(s=e.sistemas)||void 0===s?void 0:s.some(e=>b.sistemas.includes(e))})),b.ordenarPor){case"usuarios":e.sort((e,s)=>s.active_users_count-e.active_users_count);break;case"fecha":e.sort((e,s)=>new Date(s.created_at).getTime()-new Date(e.created_at).getTime());break;case"nombre":e.sort((e,s)=>e.nombre.localeCompare(s.nombre))}c(e)},[s,h,b]),(0,i.useEffect)(()=>{f();let e=a.O.channel("rooms_and_users_changes").on("postgres_changes",{event:"*",schema:"public",table:"rooms"},()=>f()).on("postgres_changes",{event:"*",schema:"public",table:"room_users"},()=>f()).subscribe();return()=>{a.O.removeChannel(e)}},[]);let N=(e,s)=>{if("regiones"===e||"idiomas"===e||"paises"===e||"sistemas"===e){let o=b[e];j(t=>({...t,[e]:o.includes(s)?o.filter(e=>e!==s):[...o,s]}))}},C=(e,s)=>{switch(e){case"EMPTY":return"\uD83D\uDCA4";case"SINGLE_USER":return"\uD83D\uDC64";case"ACTIVE":return"\uD83D\uDD25";default:return"❓"}},w=e=>{switch(e){case"EMPTY":return"text-gray-500";case"SINGLE_USER":return"text-yellow-400";case"ACTIVE":return"text-green-400";default:return"text-gray-400"}};return m?(0,t.jsxs)("div",{className:"text-white text-center py-8",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-violet-500 mx-auto mb-4"}),e("common:misc.loadingRooms")]}):d?(0,t.jsx)("div",{className:"text-red-400 text-center py-8",children:d}):(0,t.jsxs)("div",{className:"p-4 text-white max-w-6xl mx-auto",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,t.jsxs)("h2",{className:"text-3xl font-bold text-violet-300",children:["\uD83D\uDD0D ",e("common:misc.exploreRooms")]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsxs)("button",{onClick:()=>p(!v),className:"px-4 py-2 rounded-xl text-sm transition-colors ".concat(v?"bg-violet-600 text-white":"bg-violet-600/20 text-violet-300 hover:bg-violet-600/30"),children:["\uD83C\uDF9B️ ",e("common:misc.filters")]}),(0,t.jsxs)("button",{onClick:()=>{u(!0),f()},className:"px-4 py-2 bg-violet-600 hover:bg-violet-700 rounded-xl text-sm transition-colors",disabled:m,children:["\uD83D\uDD04 ",e("common:misc.refresh")]})]})]}),(0,t.jsxs)("div",{className:"mb-6",children:["        ",(0,t.jsx)("input",{type:"text",placeholder:e("common:misc.searchPlaceholder"),value:h,onChange:e=>g(e.target.value),className:"w-full bg-neutral-800 text-white px-4 py-3 rounded-xl focus:ring-2 focus:ring-violet-500 outline-none"})]}),v&&(0,t.jsxs)("div",{className:"bg-neutral-900/50 border border-violet-500 rounded-xl p-6 mb-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block text-violet-300 font-medium mb-2",children:["\uD83C\uDFAE ",e("common:misc.game")]}),(0,t.jsxs)("select",{value:b.juego,onChange:e=>j(s=>({...s,juego:e.target.value})),className:"w-full bg-neutral-800 text-white px-3 py-2 rounded-lg focus:ring-2 focus:ring-violet-500 outline-none",title:"Seleccionar juego","aria-label":"Filtrar por juego",children:[(0,t.jsx)("option",{value:"",children:e("common:misc.allGames")}),["Valorant","League of Legends","CS2","Overwatch 2","Apex Legends","Fortnite","Rocket League","FIFA 24","Call of Duty","Minecraft","Among Us","Fall Guys","Genshin Impact","Destiny 2","Rainbow Six Siege"].map(e=>(0,t.jsx)("option",{value:e,children:e},e))]})]}),"            ","            ",(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block text-violet-300 font-medium mb-2",children:["\uD83D\uDCCA ",e("common:misc.sortBy")]}),(0,t.jsxs)("select",{value:b.ordenarPor,onChange:e=>j(s=>({...s,ordenarPor:e.target.value})),className:"w-full bg-neutral-800 text-white px-3 py-2 rounded-lg focus:ring-2 focus:ring-violet-500 outline-none",title:"Ordenar salas por","aria-label":"Ordenar salas por criterio",children:[(0,t.jsx)("option",{value:"usuarios",children:e("common:misc.activeUsers")}),(0,t.jsx)("option",{value:"fecha",children:e("common:misc.mostRecent")}),(0,t.jsx)("option",{value:"nombre",children:e("common:misc.nameAZ")})]})]}),"            ",(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block text-violet-300 font-medium mb-2",children:["\uD83D\uDC65 ",e("common:misc.status")]}),(0,t.jsxs)("label",{className:"flex items-center",children:[(0,t.jsx)("input",{type:"checkbox",checked:b.soloConUsuarios,onChange:e=>j(s=>({...s,soloConUsuarios:e.target.checked})),className:"mr-2 rounded"}),(0,t.jsx)("span",{children:e("common:misc.onlyActiveRooms")})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mt-4",children:["            ",[{key:"regiones",label:"\uD83C\uDF0D ".concat(e("common:misc.regions")),options:["NA","EU","LATAM","BR","KR","JP","OCE","CN","SEA"]},{key:"idiomas",label:"\uD83D\uDDE3️ ".concat(e("common:misc.languages")),options:["Espa\xf1ol","English","Portugu\xeas","Fran\xe7ais","Deutsch","日本語","한국어","中文"]},{key:"paises",label:"\uD83C\uDFF3️ ".concat(e("common:misc.countries")),options:["M\xe9xico","Argentina","Colombia","Espa\xf1a","Chile","Per\xfa","Venezuela","Uruguay","Paraguay","Bolivia","Ecuador"]},{key:"sistemas",label:"\uD83D\uDCBB ".concat(e("common:misc.systems")),options:["PC","PlayStation","Xbox","Nintendo Switch","Mobile"]}].map(e=>{let{key:s,label:o,options:i}=e;return(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-violet-300 font-medium mb-2",children:o}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:i.map(e=>{var o;return(0,t.jsx)("button",{onClick:()=>N(s,e),className:"px-2 py-1 text-xs rounded transition-colors ".concat((null===(o=b[s])||void 0===o?void 0:o.includes(e))?"bg-violet-600 text-white":"bg-neutral-700 text-gray-300 hover:bg-neutral-600"),children:e},e)})})]},s)})]})]}),"      ",(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4 text-sm text-gray-300",children:[(0,t.jsxs)("span",{children:[e("common:misc.showing")," ",l.length," ",e("common:misc.of")," ",s.length," ",e("common:misc.rooms")]}),(0,t.jsxs)("span",{children:[s.filter(e=>e.active_users_count>0).length," ",e("common:misc.activeRooms")]})]}),(0,t.jsx)("div",{className:"grid gap-4",children:0===l.length?(0,t.jsx)("div",{className:"text-center text-gray-400 py-12",children:0===s.length?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"text-6xl mb-4",children:"\uD83C\uDFAE"}),(0,t.jsx)("h3",{className:"text-xl mb-2",children:e("common:misc.noRoomsCreated")}),(0,t.jsx)("p",{className:"mb-4",children:e("common:misc.beFirst")})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDD0D"}),(0,t.jsx)("h3",{className:"text-xl mb-2",children:e("common:misc.noRoomsFound")}),(0,t.jsx)("p",{className:"mb-4",children:e("common:misc.adjustFilters")})]})}):l.map(s=>{var o,i,n,a;return(0,t.jsxs)("div",{className:"bg-violet-800/20 border border-violet-500 rounded-xl p-6 hover:bg-violet-800/30 transition-all",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsx)("h3",{className:"text-xl font-bold text-violet-300",children:s.nombre}),(0,t.jsxs)("span",{className:"flex items-center gap-1 text-sm ".concat(w(s.room_status)),children:["                      ",C(s.room_status,s.active_users_count),s.active_users_count," ",e("common:misc.users")]})]}),(0,t.jsxs)("p",{className:"text-lg text-white",children:["\uD83C\uDFAE ",s.juego]})]}),(0,t.jsxs)("button",{onClick:()=>D.push("/room/".concat(s.id)),className:"bg-violet-600 hover:bg-violet-700 text-white py-2 px-6 rounded-lg transition-colors font-medium",children:["\uD83D\uDEAA ",e("common:misc.enter")]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm mb-4",children:["                ",(0,t.jsxs)("div",{children:[(0,t.jsxs)("span",{className:"text-gray-300",children:["\uD83C\uDF0D ",e("common:misc.regions"),":"]}),(0,t.jsx)("p",{className:"text-white",children:(null===(o=s.regiones)||void 0===o?void 0:o.join(", "))||e("common:misc.allRegions")})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("span",{className:"text-gray-300",children:["\uD83D\uDDE3️ ",e("common:misc.languages"),":"]}),(0,t.jsx)("p",{className:"text-white",children:(null===(i=s.idiomas)||void 0===i?void 0:i.join(", "))||e("common:misc.allSystems")})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("span",{className:"text-gray-300",children:["\uD83C\uDFF3️ ",e("common:misc.countries"),":"]}),(0,t.jsx)("p",{className:"text-white",children:(null===(n=s.paises)||void 0===n?void 0:n.join(", "))||e("common:misc.allSystems")})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("span",{className:"text-gray-300",children:["\uD83D\uDCBB ",e("common:misc.systems"),":"]}),(0,t.jsx)("p",{className:"text-white",children:(null===(a=s.sistemas)||void 0===a?void 0:a.join(", "))||e("common:misc.allSystems")})]})]}),"              ",(0,t.jsxs)("div",{className:"flex justify-between items-center text-xs text-gray-400",children:[(0,t.jsxs)("span",{children:[e("common:misc.created"),": ",new Date(s.created_at).toLocaleDateString()]}),s.min_jugadores&&s.max_jugadores&&(0,t.jsxs)("span",{children:["\uD83D\uDC65 ",s.min_jugadores,"-",s.max_jugadores," ",e("common:misc.players")]})]})]},s.id)})}),(0,t.jsx)("div",{className:"mt-8 text-center",children:(0,t.jsxs)("button",{onClick:()=>D.push("/rooms/create"),className:"bg-violet-600 hover:bg-violet-700 text-white py-4 px-10 rounded-xl transition-colors font-bold text-xl shadow-lg border-2 border-violet-500 hover:border-violet-400",children:["✨ ",e("common:misc.createNewRoom")]})})]})}},3303:function(e,s,o){"use strict";o.d(s,{O:function(){return t}});let t=(0,o(3288).eI)("https://hjgsgockrrnnprpddpsa.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhqZ3Nnb2NrcnJubnBycGRkcHNhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg2OTM2MDIsImV4cCI6MjA2NDI2OTYwMn0.uVhGqEllYz-PmIiizI0DE35Ov0M8CtnurLZp_z2DKEU")},9376:function(e,s,o){"use strict";var t=o(5475);o.o(t,"usePathname")&&o.d(s,{usePathname:function(){return t.usePathname}}),o.o(t,"useRouter")&&o.d(s,{useRouter:function(){return t.useRouter}})}},function(e){e.O(0,[631,971,117,744],function(){return e(e.s=9508)}),_N_E=e.O()}]);
(()=>{var e={};e.id=786,e.ids=[786],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},8893:e=>{"use strict";e.exports=require("buffer")},4770:e=>{"use strict";e.exports=require("crypto")},7702:e=>{"use strict";e.exports=require("events")},2615:e=>{"use strict";e.exports=require("http")},5240:e=>{"use strict";e.exports=require("https")},8216:e=>{"use strict";e.exports=require("net")},8621:e=>{"use strict";e.exports=require("punycode")},6162:e=>{"use strict";e.exports=require("stream")},2452:e=>{"use strict";e.exports=require("tls")},7360:e=>{"use strict";e.exports=require("url")},1568:e=>{"use strict";e.exports=require("zlib")},9975:(e,r,s)=>{"use strict";s.r(r),s.d(r,{GlobalError:()=>i.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>d,routeModule:()=>x,tree:()=>c}),s(1959),s(1506),s(5866);var t=s(3191),a=s(8716),o=s(7922),i=s.n(o),l=s(5231),n={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>l[e]);s.d(r,n);let c=["",{children:["room",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,1959)),"D:\\gamer-chat-app\\app\\room\\[id]\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,1506)),"D:\\gamer-chat-app\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],d=["D:\\gamer-chat-app\\app\\room\\[id]\\page.tsx"],m="/room/[id]/page",u={require:s,loadChunk:()=>Promise.resolve()},x=new t.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/room/[id]/page",pathname:"/room/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},2559:(e,r,s)=>{Promise.resolve().then(s.bind(s,8732))},8732:(e,r,s)=>{"use strict";s.d(r,{default:()=>n});var t=s(326),a=s(7577),o=s(5472),i=s(5047),l=s(12);function n({roomId:e}){let{t:r}=(0,l.$G)(["chat","common"]),[s,n]=(0,a.useState)(null),[c,d]=(0,a.useState)(null),[m,u]=(0,a.useState)([]),[x,h]=(0,a.useState)([]),[p,g]=(0,a.useState)(""),[v,j]=(0,a.useState)(!0),[f,_]=(0,a.useState)(""),[b,N]=(0,a.useState)(!1),y=(0,a.useRef)(null),w=(0,i.useRouter)(),D=async()=>{let{data:r,error:s}=await o.O.from("active_room_users").select("*").eq("room_id",e);if(s)throw s;h(r||[])},q=async r=>{try{let{error:s}=await o.O.from("room_users").update({is_active:!1,last_seen:new Date().toISOString()}).eq("room_id",e).eq("user_id",r);if(s){console.error("Error al marcar usuario como inactivo:",s);return}let{data:t,error:a}=await o.O.from("room_users").select("id").eq("room_id",e).eq("is_active",!0);if(!a&&t&&0===t.length){let{error:r}=await o.O.from("rooms").delete().eq("id",e);r?console.error("Error al eliminar sala vac\xeda:",r):console.log("Sala eliminada por estar vac\xeda")}}catch(e){console.error("Error en leaveRoom:",e)}},k=async r=>{if(r.preventDefault(),!p.trim()||!s)return;let{error:t}=await o.O.from("chat_messages").insert({room_id:e,user_id:s.id,content:p.trim()});if(t){console.error("Error enviando mensaje:",t);return}g("")},E=async(t,a)=>{if(!s||!c||s.id!==c.creador_id){console.error(r("chat.moderation.onlyCreatorCanKick"));return}if(t===s.id){console.error(r("chat.moderation.cannotKickSelf"));return}try{let{data:i,error:l}=await o.O.rpc("kick_user_from_room",{room_id_param:e,creator_id_param:s.id,user_to_kick_id_param:t});if(l){console.error(r("chat.moderation.kickError"),l);return}i?.success?(console.log(r("chat.moderation.userKicked",{username:a})),await D()):console.error(r("chat.moderation.kickError"),i?.error)}catch(e){console.error(r("chat.moderation.kickError"),e)}},S=async()=>{if(s)try{j(!0);let{data:r,error:t}=await o.O.rpc("leave_room_safely",{room_id_param:e,user_id_param:s.id});t?(console.error("Error al salir de la sala:",t),await q(s.id)):(console.log("Resultado al salir:",r),r?.room_deleted&&console.log("Sala eliminada autom\xe1ticamente por estar vac\xeda"))}catch(e){console.error("Error inesperado al salir:",e),await q(s.id)}finally{w.push("/rooms")}};return v?t.jsx("div",{className:"min-h-screen flex items-center justify-center",children:t.jsx("div",{className:"text-white text-xl",children:r("chat.room.loading")})}):f?t.jsx("div",{className:"min-h-screen flex items-center justify-center",children:t.jsx("div",{className:"text-red-400 text-xl",children:f})}):c?t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900",children:(0,t.jsxs)("div",{className:"container mx-auto px-4 py-6",children:[(0,t.jsxs)("div",{className:"bg-violet-800/20 border border-violet-500 rounded-xl p-6 mb-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,t.jsxs)("div",{children:[t.jsx("h1",{className:"text-3xl font-bold text-violet-300 mb-2",children:c.nombre}),(0,t.jsxs)("p",{className:"text-lg text-white",children:["\uD83C\uDFAE ",c.juego]})]}),"            ",(0,t.jsxs)("button",{onClick:S,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-all duration-200 font-medium text-sm flex items-center gap-2 hover:scale-105",title:r("chat.room.leaveRoom"),children:["\uD83D\uDEAA ",r("chat.room.leaveRoomShort")]})]}),"          ",(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("span",{className:"text-gray-300",children:["\uD83C\uDF0D ",r("chat.room.regions"),":"]}),t.jsx("p",{className:"text-white",children:c.regiones?.join(", ")||r("common.all")})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("span",{className:"text-gray-300",children:["\uD83D\uDDE3️ ",r("chat.room.languages"),":"]}),t.jsx("p",{className:"text-white",children:c.idiomas?.join(", ")||r("common.all")})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("span",{className:"text-gray-300",children:["\uD83C\uDFF3️ ",r("chat.room.countries"),":"]}),t.jsx("p",{className:"text-white",children:c.paises?.join(", ")||r("common.all")})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("span",{className:"text-gray-300",children:["\uD83D\uDCBB ",r("chat.room.systems"),":"]}),t.jsx("p",{className:"text-white",children:c.sistemas?.join(", ")||r("common.all")})]})]}),c.min_jugadores&&c.max_jugadores&&(0,t.jsxs)("div",{className:"mt-2",children:[(0,t.jsxs)("span",{className:"text-gray-300",children:["\uD83D\uDC65 ",r("chat.room.players"),":"]}),(0,t.jsxs)("span",{className:"text-white ml-2",children:[c.min_jugadores,"-",c.max_jugadores]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[t.jsx("div",{className:"lg:col-span-3",children:(0,t.jsxs)("div",{className:"bg-neutral-900/50 border border-violet-500 rounded-xl h-[600px] flex flex-col",children:["              ",t.jsx("div",{className:"p-4 border-b border-violet-500",children:(0,t.jsxs)("h2",{className:"text-xl font-semibold text-violet-300",children:[r("chat.room.title")," \uD83D\uDCAC"]})}),(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[m.map(e=>t.jsx("div",{className:`flex ${e.user_id===s?.id?"justify-end":"justify-start"}`,children:(0,t.jsxs)("div",{className:"flex items-start gap-3 max-w-[75%]",children:[e.user_id!==s?.id&&t.jsx("img",{className:"w-8 h-8 rounded-full object-cover",src:e.avatar_url||"/logo.png",alt:e.username||"Usuario"}),(0,t.jsxs)("div",{className:`flex flex-col p-3 rounded-xl ${e.user_id===s?.id?"bg-violet-600 rounded-tr-none":"bg-neutral-800 rounded-tl-none"}`,children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[t.jsx("span",{className:"text-xs font-semibold text-white",children:e.username||"Usuario"}),t.jsx("span",{className:"text-xs text-gray-400",children:new Date(e.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),t.jsx("p",{className:"text-sm text-white whitespace-pre-wrap break-words",children:e.content})]}),e.user_id===s?.id&&t.jsx("img",{className:"w-8 h-8 rounded-full object-cover",src:e.avatar_url||s?.user_metadata?.avatar_url||"/logo.png",alt:e.username||"Usuario"})]})},e.id)),t.jsx("div",{ref:y})]}),t.jsx("form",{onSubmit:k,className:"p-4 border-t border-violet-500",children:(0,t.jsxs)("div",{className:"flex gap-3",children:["                  ",t.jsx("input",{type:"text",value:p,onChange:e=>g(e.target.value),placeholder:r("chat.room.messagePlaceholder"),className:"flex-1 bg-neutral-800 text-white px-4 py-2 rounded-lg focus:ring-2 focus:ring-violet-500 outline-none",disabled:!s}),t.jsx("button",{type:"submit",className:"bg-violet-600 hover:bg-violet-700 text-white px-6 py-2 rounded-lg transition-colors font-medium disabled:opacity-50",disabled:!s||!p.trim(),children:r("chat:chat.send")})]})})]})}),t.jsx("div",{className:"lg:col-span-1",children:(0,t.jsxs)("div",{className:"bg-neutral-900/50 border border-violet-500 rounded-xl h-[600px] flex flex-col",children:["              ",t.jsx("div",{className:"p-4 border-b border-violet-500",children:(0,t.jsxs)("h3",{className:"text-lg font-semibold text-violet-300",children:[r("chat.room.usersInRoom")," (",x.length,")"]})}),t.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:x.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-neutral-800/50 rounded-lg group",children:[t.jsx("img",{className:"w-10 h-10 rounded-full object-cover",src:e.avatar_url||"/logo.png",alt:e.username||"Usuario"}),(0,t.jsxs)("div",{className:"flex-1",children:[t.jsx("p",{className:"text-white font-medium",children:e.username||"Usuario"}),(0,t.jsxs)("p",{className:"text-xs text-gray-400",children:[e.user_id===c.creador_id&&`👑 ${r("chat.room.creator")}`,e.user_id===s?.id&&` (${r("chat.room.you")})`]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),s&&c&&s.id===c.creador_id&&e.user_id!==s.id&&t.jsx("button",{onClick:()=>E(e.user_id,e.username||"Usuario"),className:"opacity-0 group-hover:opacity-100 text-red-400 hover:text-red-300 text-xs p-1 rounded transition-all duration-200 hover:bg-red-900/20",title:r("chat.actions.kickUser"),children:"\uD83D\uDEAB"})]})]},e.id))})]})})]})]})}):t.jsx("div",{className:"min-h-screen flex items-center justify-center",children:t.jsx("div",{className:"text-white text-xl",children:r("chat.room.notFound")})})}},1959:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>o});var t=s(9510);let a=(0,s(8570).createProxy)(String.raw`D:\gamer-chat-app\components\RoomChat.tsx#default`);function o({params:e}){return t.jsx(a,{roomId:e.id})}}};var r=require("../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[202,810],()=>s(9975));module.exports=t})();